<!DOCTYPE html>
<html>
<head>
    <title>GamePong2 ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        #log {
            height: 300px;
            overflow-y: scroll;
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            font-family: monospace;
        }
        input {
            padding: 8px;
            margin: 5px;
            background: #333;
            color: white;
            border: 1px solid #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>GamePong2 ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>

        <div class="section">
            <h3>æ¥ç¶šãƒ†ã‚¹ãƒˆ</h3>
            <input type="text" id="roomNumber" value="000042" placeholder="éƒ¨å±‹ç•ªå·">
            <button onclick="connectToRoom()">éƒ¨å±‹ã«æ¥ç¶š</button>
            <button onclick="startGame()">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
            <button onclick="disconnect()">åˆ‡æ–­</button>
        </div>

        <div class="section">
            <h3>ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°</h3>
            <div id="log"></div>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>

        <div class="section">
            <h3>ãƒ†ã‚¹ãƒˆæ‰‹é †</h3>
            <ol>
                <li>2ã¤ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ã§ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã</li>
                <li>ä¸¡æ–¹ã®ã‚¿ãƒ–ã§åŒã˜éƒ¨å±‹ç•ªå·ã«æ¥ç¶š</li>
                <li>ã©ã¡ã‚‰ã‹ã®ã‚¿ãƒ–ã§ã€Œã‚²ãƒ¼ãƒ é–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>ä¸¡æ–¹ã®ã‚¿ãƒ–ã§ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª</li>
            </ol>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        let socket = null;
        let currentRoom = null;

        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function connectToRoom() {
            const roomNumber = document.getElementById('roomNumber').value;
            if (!roomNumber) {
                log('ERROR: éƒ¨å±‹ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            disconnect(); // æ—¢å­˜ã®æ¥ç¶šã‚’åˆ‡æ–­

            log(`æ¥ç¶šä¸­... Room: ${roomNumber}`);

            // Socket.IOæ¥ç¶š
            socket = io('ws://localhost:3001');
            currentRoom = roomNumber;

            socket.on('connect', () => {
                log(`âœ“ ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã—ã¾ã—ãŸ (ID: ${socket.id})`);

                // éƒ¨å±‹ã«å‚åŠ 
                socket.emit('join-room', {
                    roomNumber: roomNumber,
                    playerInfo: {
                        id: socket.id,
                        avatar: 'test-avatar.png',
                        name: `Player-${Math.random().toString(36).substr(2, 4)}`
                    }
                });
            });

            socket.on('room-joined', (data) => {
                log(`âœ“ éƒ¨å±‹ã«å‚åŠ ã—ã¾ã—ãŸ: Player ${data.playerNumber}`);
                log(`  - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${data.players.length}`);
                log(`  - ã‚²ãƒ¼ãƒ æº–å‚™å®Œäº†: ${data.isGameReady}`);
            });

            socket.on('player-joined', (data) => {
                log(`âœ“ ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå‚åŠ : Player ${data.playerNumber}`);
                log(`  - ã‚²ãƒ¼ãƒ æº–å‚™å®Œäº†: ${data.isGameReady}`);
            });

            socket.on('game-ready', (data) => {
                log('âœ“ ã‚²ãƒ¼ãƒ æº–å‚™å®Œäº†ï¼2äººã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒæƒã„ã¾ã—ãŸ');
            });

            socket.on('game-started', (data) => {
                log('ğŸ® ã‚²ãƒ¼ãƒ é–‹å§‹ï¼');
                log(`  - é–‹å§‹è€…: ${data.initiator}`);
                log(`  - å‚åŠ è€…æ•°: ${data.players.length}`);
            });

            socket.on('game-start-failed', (data) => {
                log(`âŒ ã‚²ãƒ¼ãƒ é–‹å§‹å¤±æ•—: ${data.reason}`);
                log(`  - ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°: ${data.currentPlayers}`);
            });

            socket.on('error', (data) => {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${data.message}`);
            });

            socket.on('disconnect', () => {
                log('âŒ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰åˆ‡æ–­ã•ã‚Œã¾ã—ãŸ');
            });
        }

        function startGame() {
            if (!socket || !currentRoom) {
                log('ERROR: éƒ¨å±‹ã«æ¥ç¶šã—ã¦ãã ã•ã„');
                return;
            }

            log('ã‚²ãƒ¼ãƒ é–‹å§‹è¦æ±‚ã‚’é€ä¿¡ä¸­...');
            socket.emit('start-game', {
                roomNumber: currentRoom
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
                currentRoom = null;
                log('åˆ‡æ–­ã—ã¾ã—ãŸ');
            }
        }

        // åˆæœŸåŒ–
        log('ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–å®Œäº†');
        log('éƒ¨å±‹ç•ªå·ã‚’å…¥åŠ›ã—ã¦ã€Œéƒ¨å±‹ã«æ¥ç¶šã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„');
    </script>
</body>
</html>
